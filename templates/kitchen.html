{% extends "base.html" %}

{% block title %}Cocina - Sistema de Pedidos{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h3 fw-bold mb-0">
            <i class="bi bi-fire"></i> Pantalla de Cocina
        </h2>
        <div class="badge bg-primary fs-6 px-3 py-2">
            <i class="bi bi-list-check"></i> {{ orders|length }} pedidos activos
        </div>
    </div>

    {% if not orders %}
    <div class="text-center text-muted mt-5 py-5">
        <i class="bi bi-check-circle" style="font-size: 5rem; opacity: 0.3;"></i>
        <p class="h5 mt-3">No hay pedidos pendientes</p>
        <p class="text-muted">Todos los pedidos han sido procesados</p>
    </div>
    {% else %}
    <div class="row g-3">
        {% for order in orders %}
            {% set status_config = {
                'pending': {'color': 'warning', 'bg': 'bg-warning bg-opacity-10', 'icon': 'bi-hourglass-split', 'btn': 'Iniciar', 'next': 'preparing', 'btn_class': 'btn-info'},
                'preparing': {'color': 'info', 'bg': 'bg-info bg-opacity-10', 'icon': 'bi-arrow-repeat', 'btn': 'Listo', 'next': 'ready', 'btn_class': 'btn-success'},
                'ready': {'color': 'success', 'bg': 'bg-success bg-opacity-10', 'icon': 'bi-check-circle', 'btn': 'Entregar', 'next': 'delivered', 'btn_class': 'btn-secondary'}
            }.get(order.get('estado', 'pending'), {'color': 'secondary', 'bg': 'bg-secondary bg-opacity-10', 'icon': 'bi-question-circle', 'btn': 'Siguiente', 'next': 'delivered', 'btn_class': 'btn-secondary'}) %}
            
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="card h-100 border-0 shadow-sm border-start border-4 border-{{ status_config.color }}">
                    <div class="card-body {{ status_config.bg }}">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5 class="card-title fw-bold mb-1">{{ order.get('numero_pedido', '') }}</h5>
                                <small class="text-muted">
                                    <i class="bi bi-clock"></i> {% if order.get('fecha_hora') %}{{ order.get('fecha_hora').strftime('%I:%M %p') }}{% endif %}
                                </small>
                            </div>
                            <i class="bi {{ status_config.icon }} fs-3 text-{{ status_config.color }}"></i>
                        </div>

                        <div class="card bg-white mb-3">
                            <div class="card-body">
                                <div class="list-group list-group-flush">
                                    {% for item in order.get('items', []) %}
                                    <div class="list-group-item px-0 d-flex justify-content-between align-items-center border-0">
                                        <span class="fw-medium">{{ item.get('producto_nombre', '') }}</span>
                                        <span class="badge bg-light text-dark">x{{ item.get('cantidad', 0) }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                                <hr class="my-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="fw-bold">Total:</span>
                                    <span class="fw-bold text-success fs-5">Q{{ "{:.2f}".format(order.get('total_final', 0)) }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex">
                            <a href="/kitchen/status?order_id={{ order.get('id') }}&new_status={{ status_config.next }}" 
                               class="btn {{ status_config.btn_class }} flex-grow-1">
                                <i class="bi bi-arrow-right-circle"></i> {{ status_config.btn }}
                            </a>
                            <a href="/print?order_id={{ order.get('id') }}" target="_blank"
                               class="btn btn-outline-secondary">
                                <i class="bi bi-printer"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}

